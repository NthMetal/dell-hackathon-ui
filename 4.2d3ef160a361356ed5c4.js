(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"ct+p":function(t,e,a){"use strict";a.r(e),a.d(e,"HomeModule",function(){return m});var i=a("ofXK"),s=a("tyNb"),n=a("a0Xn"),r=a("fXoL"),c=a("jr3z"),o=a("Wp6s"),u=a("bTqV"),l=a("Xa2L");function b(t,e){1&t&&(r.Tb(0,"div",6),r.Ob(1,"mat-spinner"),r.Sb())}function d(t,e){if(1&t&&(r.Rb(0),r.Ob(1,"div",8),r.Qb()),2&t){const t=r.ec(2);r.Cb(1),r.kc("chart",t.chart)}}function h(t,e){if(1&t&&(r.Tb(0,"div",6),r.xc(1,d,2,1,"ng-container",7),r.Sb()),2&t){const t=r.ec();r.Cb(1),r.kc("ngIf",t.chart)}}const p=function(){return["/oxygensupply"]},f=function(){return["/hospital"]},y=[{path:"",component:(()=>{class t{constructor(t){this.tweetDataService=t,this.currentPage="/",this.newSeriesData=[],this.isLoaded=!1}ngOnInit(){this.tweetDataService.loadedSubject.subscribe(t=>{this.isLoaded=t}),this.tweetDataService.getTweetDataSubject().subscribe(t=>{this.setPackedBubbleData(t.slice(0,100),"20%","150%")}),this.tweetDataService.getNewTweetObservable().subscribe(t=>{this.chart&&this.updatePackedBubbleData(t)})}initBubbleChart(t="50%",e="300%"){this.chart&&this.chart.destroy(),this.chart=new n.a({chart:{type:"packedbubble",backgroundColor:"transparent"},title:{text:"Untitled"},credits:{enabled:!1},tooltip:{useHTML:!0,pointFormat:"<b>{point.name}:</b> {point.value} tweets"},plotOptions:{packedbubble:{minSize:t,maxSize:e,layoutAlgorithm:{splitSeries:"",gravitationalConstant:.02},dataLabels:{enabled:!0,format:"{point.name}",filter:{property:"y",operator:">",value:250},style:{color:"black",textOutline:"none",fontWeight:"normal"}}}},series:[]})}initWordChart(){this.wordChart=new n.a({chart:{type:"wordcloud",backgroundColor:"transparent"},credits:{enabled:!1},title:{text:"Wordcloud"},series:[]})}classifyByCity(t){return t.reduce((t,e)=>{const a=e.user?e.user.location:"Missing",i=t.find(t=>t.city===a);return i?i.tweets.push(e):t.push({city:a,tweets:[e]}),t},[])}setPackedBubbleData(t,e,a){this.initBubbleChart(e,a);const i=this.classifyByCity(t),s=[];i.forEach(t=>{s.push({name:t.city,type:"packedbubble",data:[{name:t.city,value:t.tweets.length}]})}),s.sort((t,e)=>e.data[0].value-t.data[0].value).slice(0,10).forEach(t=>this.chart.addSeries(t,!0,!0))}setWordChartData(t){this.initWordChart();const e=t.reduce((t,e)=>t+(e.text+"\n"),"").split(/[,\. ]+/g).reduce((t,e)=>{var a=t.find(t=>t.name===e);return a?a.weight+=1:t.push(a={name:e,weight:1}),t},[]);this.wordChart.addSeries({type:"wordcloud",data:e,name:"Occurrences"},!0,!0)}updatePackedBubbleData(t){this.classifyByCity(t).forEach(t=>{const e=this.chart.ref.series.find(e=>e.name===t.city);if(e){const a=Object.assign({},e.data[0]);a.value=a.value+t.tweets.length,e.setData([a])}else{let e=this.newSeriesData.find(e=>e.name===t.city);e?e.value=e.value+t.tweets.length:(e={name:t.city,value:t.tweets.length},this.newSeriesData.push(e));const a=this.chart.ref.series.sort((t,e)=>t.data[0].value-e.data[0].value)[0];if(!a||this.chart.ref.series.length<2){const a={name:t.city,type:"packedbubble",data:[{name:t.city,value:e.value}]};this.newSeriesData.splice(this.newSeriesData.indexOf(e),1),this.chart.addSeries(a,!0,!0)}if(this.chart.ref.series.length>1&&e.value>a.data[0].value){const i={name:t.city,type:"packedbubble",data:[{name:t.city,value:e.value}]};this.newSeriesData.push({name:a.name,value:a.data[0].value}),this.newSeriesData.splice(this.newSeriesData.indexOf(e),1),this.chart.removeSeries(this.chart.ref.series.indexOf(a)),this.chart.addSeries(i,!0,!0)}}})}}return t.\u0275fac=function(e){return new(e||t)(r.Nb(c.a))},t.\u0275cmp=r.Hb({type:t,selectors:[["app-home"]],decls:12,vars:6,consts:[[1,"row"],[1,"col"],["class","col-auto",4,"ngIf"],[1,"row","justify-content-around"],[1,"col-3"],["mat-button","",3,"routerLink"],[1,"col-auto"],[4,"ngIf"],[3,"chart"]],template:function(t,e){1&t&&(r.Tb(0,"div",0),r.Ob(1,"div",1),r.xc(2,b,2,0,"div",2),r.xc(3,h,2,1,"div",2),r.Ob(4,"div",1),r.Sb(),r.Tb(5,"div",3),r.Tb(6,"mat-card",4),r.Tb(7,"button",5),r.yc(8,"Oxygen Supply"),r.Sb(),r.Sb(),r.Tb(9,"mat-card",4),r.Tb(10,"button",5),r.yc(11,"Hospital"),r.Sb(),r.Sb(),r.Sb()),2&t&&(r.Cb(2),r.kc("ngIf",!e.isLoaded),r.Cb(1),r.kc("ngIf",e.isLoaded),r.Cb(4),r.kc("routerLink",r.lc(4,p)),r.Cb(3),r.kc("routerLink",r.lc(5,f)))},directives:[i.l,o.a,u.a,s.a,l.b,n.b],styles:[""]}),t})()}];let v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Lb({type:t}),t.\u0275inj=r.Kb({imports:[[s.b.forChild(y)],s.b]}),t})();var w=a("vvyD");let m=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Lb({type:t}),t.\u0275inj=r.Kb({imports:[[i.c,v,n.c,w.a]]}),t})()}}]);